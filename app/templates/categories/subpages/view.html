{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>{{ subpage.title }}</h3>
  <div class="d-flex gap-2">
    <a href="{{ url_for('categories.view_category', category_id=subpage.category_id) }}" class="btn btn-outline-secondary">
      <i class="fas fa-arrow-left me-2"></i>Back to Category
    </a>
    <form method="post" action="{{ url_for('categories.delete_subpage', subpage_id=subpage.id) }}" onsubmit="return confirm('Move to trash?')" class="d-inline">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <button type="submit" class="btn btn-outline-danger">
        <i class="fas fa-trash me-2"></i>Delete
      </button>
    </form>
  </div>
</div>

<form method="post">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <div class="mb-2">
    <label class="form-label">Title</label>
    <input class="form-control" name="title" value="{{ subpage.title }}" required>
  </div>
  <div class="mb-2">
    <label class="form-label">Content</label>
    <div id="sp-editor" class="quill-editor" style="height: 300px;">{{ subpage.content | safe }}</div>
    <input type="hidden" name="content" id="sp-content">
  </div>
  <button class="btn btn-primary" onclick="syncQuill('sp-editor','sp-content')">Save</button>
</form>

<hr>
<h5>Files</h5>
<form method="post" action="{{ url_for('categories.upload_to_subpage', subpage_id=subpage.id) }}" enctype="multipart/form-data">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <input type="file" name="file" class="form-control" required>
  <button class="btn btn-secondary mt-2">Upload</button>
</form>
<ul class="list-group mt-3">
  {% for f in subpage.files %}
    <li class="list-group-item d-flex justify-content-between">
      <span>{{ f.filename }}</span>
      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('files.download_file', file_id=f.id) }}">Download</a>
    </li>
  {% endfor %}
</ul>
{% endblock %}